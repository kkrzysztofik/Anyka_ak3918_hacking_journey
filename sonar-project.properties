# SonarQube Project Configuration
# This file configures SonarQube analysis for the Anyka AK3918 project

# Project identification
sonar.projectKey=kkrzysztofik_Anyka_ak3918_hacking_journey
sonar.projectName=Anyka AK3918 ONVIF Implementation
sonar.organization=kkrzysztofik

# Source code paths
sonar.sources=cross-compile

# Exclusions - Files and directories to exclude from analysis
# Exclude vendor reference code (not maintained by us)
sonar.exclusions=cross-compile/anyka_reference/**

# FFI Bindings Exclusions
# Exclude generated FFI bindings (safe but trigger false positives)
sonar.exclusions+=cross-compile/onvif-rust/src/ffi/generated/**

# FFI Pattern Exclusions
# Documented FFI wrapper code with explicit safety annotations
# These files contain NOSONAR markers for documented safe transmute operations
# See: cross-compile/onvif-rust/src/ffi/anyka_sdk.rs (lines with NOSONAR comments)

# e1: Safe transmute operations for FFI enum mapping
# Rule S5343: transmute should not be used
# Justification: Converting i32 to C enum types with known valid ranges
sonar.issue.ignore.multicriteria.e1.ruleKey=rust:S5343
sonar.issue.ignore.multicriteria.e1.resourceKey=**/anyka_sdk.rs

# =============================================================================
# JavaScript/TypeScript Project Exclusions - cross-compile/www
# =============================================================================

# e2: React Props Readonly - False Positive for React Patterns
# Rule: typescript:S6759
# Justification: React props are internally immutable by React's design.
# Marking as readonly can cause type conflicts with React's internal prop handling.
sonar.issue.ignore.multicriteria.e2.ruleKey=typescript:S6759
sonar.issue.ignore.multicriteria.e2.resourceKey=cross-compile/www/**/*.tsx

# e3: GitHub Actions Permissions - Appropriately Scoped
# Rule: githubactions:S8233
# Justification: Permissions are explicitly scoped (contents:read, pull-requests:write).
# NOT using write-all. These are minimal, necessary permissions for CI functionality.
sonar.issue.ignore.multicriteria.e3.ruleKey=githubactions:S8233
sonar.issue.ignore.multicriteria.e3.resourceKey=.github/workflows/*.yml

# e4: shadcn/ui Component Accessibility
# Rule: typescript:S6850
# Justification: Accessibility handled by component library. Content provided via children.
sonar.issue.ignore.multicriteria.e4.ruleKey=typescript:S6850
sonar.issue.ignore.multicriteria.e4.resourceKey=cross-compile/www/src/components/ui/*.tsx

# Set all multicriteria rules (comma-separated list)
sonar.issue.ignore.multicriteria=e1,e2,e3,e4

# Binary files and libraries - exclude compiled binaries that cause encoding errors
sonar.exclusions+=**/*.a,**/*.so,**/*.so.*,**/*.dylib,**/*.dll

# Vendor libraries and binary library directories
# Exclude vendor Rust dependencies and binary library directories
sonar.exclusions+=cross-compile/onvif-rust/vendor/**,cross-compile/onvif/lib/**,cross-compile/onvif/tests/lib/**
# Exclude vendor SDK header files (they have encoding issues and are not maintained by us)
sonar.exclusions+=cross-compile/onvif/include/**

# Additional exclusions for build artifacts, generated files, etc.
# Note: Excluding HTML coverage directories but allowing report files (*.xml, *.info, lcov.info)
sonar.exclusions+=**/target/**,**/build/**,**/out/**,**/node_modules/**,**/coverage/html/**,**/coverage/**/*.html

# Test exclusions (if you want to exclude test files from analysis)
# sonar.test.exclusions=**/*test*.rs,**/*spec*.ts

# Language-specific settings
sonar.sourceEncoding=UTF-8

# =============================================================================
# Rust Code Analysis Configuration
# =============================================================================
# SonarQube supports native Rust code analysis (available in SonarQube 2025.3+)
# It integrates with Clippy (Rust's linter) and provides:
# - 85+ Clippy rules integrated into Quality Profiles
# - Code metrics: Cognitive Complexity, Cyclomatic Complexity
# - Code coverage import (LCOV and Cobertura formats)
#
# Prerequisites:
# - Cargo (Rust package manager) must be installed and in PATH
# - Clippy must be installed: rustup component add clippy
#
# By default, SonarQube automatically detects Cargo.toml files and triggers
# Clippy analysis. You can customize this behavior with the properties below.

# Rust Cargo Manifest Paths (optional - auto-detected if not specified)
# Specify paths to Cargo.toml files if SonarQube doesn't auto-detect them
# Paths are relative to project root or absolute paths, comma-separated
sonar.rust.cargo.manifestPaths=cross-compile/onvif-rust/Cargo.toml

# Enable/disable Clippy analysis (default: true)
# Set to false if you want to disable Clippy integration
sonar.rust.clippy.enable=true

# =============================================================================
# Coverage Report Configuration - Multiple Projects
# =============================================================================
# SonarQube supports multiple coverage reports from different sub-projects.
# Each language/framework can have its own coverage report path(s).
# Paths are comma-separated (no spaces) and can be relative to project root
# or absolute paths.

# Rust Project Coverage (Cobertura XML format from cargo-tarpaulin)
# Cobertura XML reports are read via the JaCoCo property name
sonar.coverage.jacoco.xmlReportPaths=cross-compile/onvif-rust/coverage/cobertura.xml

# C/C++ Project Coverage (LCOV format from gcov/lcov)
# LCOV format for C/C++ code analysis
sonar.cxx.coverage.reportPaths=cross-compile/onvif/tests/coverage/coverage.info

# JavaScript/TypeScript Project Coverage (LCOV format from vitest)
# Note: Configure vitest to generate LCOV format in addition to other formats
# Add 'lcov' to the coverage.reporter array in vite.config.ts
# Example: coverage: { reporter: ['text', 'json', 'html', 'lcov'] }
sonar.javascript.lcov.reportPaths=cross-compile/www/coverage/lcov.info

# =============================================================================
# Coverage Report Notes
# =============================================================================
# 1. Rust (onvif-rust): Generates Cobertura XML via cargo-tarpaulin
#    - Report location: cross-compile/onvif-rust/coverage/cobertura.xml
#    - Generated by: cargo tarpaulin --out Xml
#    - Note: SonarQube Rust analysis supports both Cobertura XML and LCOV formats
#    - Alternative: Use --out Lcov to generate LCOV format if preferred
#
# 2. C/C++ (onvif/tests): Generates LCOV via gcov/lcov
#    - Report location: cross-compile/onvif/tests/coverage/coverage.info
#    - Generated by: make coverage-html or make coverage-report
#
# 3. JavaScript/TypeScript (www): Should generate LCOV via vitest
#    - Report location: cross-compile/www/coverage/lcov.info
#    - Requires: Update vite.config.ts to include 'lcov' in coverage.reporter
#
# All coverage reports are aggregated by SonarQube into a single coverage view
# for the entire project, allowing you to see coverage across all languages.
